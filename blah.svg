<svg width="1200" height="1600" viewBox="0 0 1200 1600" xmlns="http://www.w3.org/2000/svg">
  <!-- Arrow marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
  </text>

  <!-- Start -->
  <circle cx="600" cy="90" r="12" fill="#000"/>
  <line x1="600" y1="102" x2="600" y2="128" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Open RTSP -->
  <rect x="510" y="130" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="160" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Open RTSP Stream</text>

  <!-- Serve UI -->
  <line x1="600" y1="180" x2="600" y2="208" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="510" y="210" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="240" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Serve UI Channels</text>
  <text x="600" y="256" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">(MJPEG + WebSocket)</text>

  <!-- Ingest OCR -->
  <line x1="600" y1="260" x2="600" y2="288" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="510" y="290" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="320" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Ingest OCR Event</text>

  <!-- Confidence gate -->
  <line x1="600" y1="340" x2="600" y2="368" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="510" y="370" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="400" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Apply Confidence Gate</text>

  <!-- Decision: Pass threshold? -->
  <line x1="600" y1="420" x2="600" y2="448" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <polygon points="600,450 650,490 600,530 550,490" fill="#ffe0b2" stroke="#ef6c00" stroke-width="2"/>
  <text x="600" y="486" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Pass threshold?</text>

  <!-- No -> Discard -->
  <line x1="550" y1="490" x2="450" y2="490" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="350" y="470" width="100" height="40" rx="20" fill="#ffcdd2" stroke="#d32f2f" stroke-width="2"/>
  <text x="400" y="494" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Discard</text>
  <path d="M 400 470 L 400 320 L 508 320" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Yes -> Event Type -->
  <line x1="650" y1="490" x2="750" y2="490" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Decision: Event Type? -->
  <polygon points="800,450 850,490 800,530 750,490" fill="#ffe0b2" stroke="#ef6c00" stroke-width="2"/>
  <text x="800" y="486" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Event Type?</text>

  <!-- Timed path: check match -->
  <line x1="800" y1="530" x2="800" y2="570" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="710" y="570" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="800" y="595" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Check License Plate Match</text>

  <!-- Decision: Has car exceeded time limit? -->
  <line x1="800" y1="620" x2="800" y2="660" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <polygon points="800,660 850,700 800,740 750,700" fill="#ffe0b2" stroke="#ef6c00" stroke-width="2"/>
  <text x="800" y="694" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Has car exceeded</text>
  <text x="800" y="712" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">time limit?</text>

  <!-- Elbowed YES path: down, left, down to Save Evidence -->
  <path d="M 800 740 L 800 840 L 600 840 L 600 1030" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="812" y="792" font-family="Arial, sans-serif" font-size="11" fill="#666">[yes]</text>

  <!-- Elbowed NO path: up, left, down to Save Evidence -->
  <path d="M 800 660 L 800 600 L 600 600 L 600 1030" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="812" y="628" font-family="Arial, sans-serif" font-size="11" fill="#666">[no]</text>

  <!-- Permit path from Event Type (left branch guiding line) -->
  <line x1="750" y1="490" x2="450" y2="490" stroke="#333" stroke-width="2"/>
  <line x1="450" y1="490" x2="450" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="470" y="536" font-family="Arial, sans-serif" font-size="11" fill="#666">[Permit]</text>

  <!-- Permit: DB Lookup -->
  <rect x="360" y="580" width="180" height="60" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="450" y="604" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">License Plate</text>
  <text x="450" y="622" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Database Lookup</text>
  <text x="450" y="640" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">(Permit validation)</text>

  <!-- Decision: Valid permit? -->
  <line x1="450" y1="640" x2="450" y2="678" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <polygon points="450,680 500,720 450,760 400,720" fill="#ffe0b2" stroke="#ef6c00" stroke-width="2"/>
  <text x="450" y="716" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Valid permit?</text>

  <!-- Invalid -> Reject -->
  <line x1="400" y1="720" x2="300" y2="720" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="200" y="700" width="100" height="40" rx="20" fill="#ffcdd2" stroke="#d32f2f" stroke-width="2"/>
  <text x="250" y="724" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#333">Reject</text>

  <!-- Valid -> merge to Save Evidence path -->
  <line x1="450" y1="760" x2="450" y2="1010" stroke="#333" stroke-width="2"/>
  <line x1="450" y1="1010" x2="580" y2="1010" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="462" y="786" font-family="Arial, sans-serif" font-size="11" fill="#666">[yes]</text>

  <!-- Merge node (for other branches) -->
  <circle cx="600" cy="1010" r="20" fill="#fff" stroke="#333" stroke-width="2"/>
  <circle cx="600" cy="1010" r="15" fill="#333"/>
  <line x1="600" y1="1030" x2="600" y2="1078" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Save Evidence -->
  <rect x="510" y="1080" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="1110" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Save Evidence</text>

  <!-- Update UI & List -->
  <line x1="600" y1="1130" x2="600" y2="1178" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="510" y="1180" width="180" height="50" rx="25" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="600" y="1210" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Update UI & List</text>

  <!-- End -->
  <line x1="600" y1="1230" x2="600" y2="1260" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <circle cx="600" cy="1280" r="12" fill="#fff" stroke="#000" stroke-width="3"/>
  <circle cx="600" cy="1280" r="6" fill="#000"/>
</svg>
